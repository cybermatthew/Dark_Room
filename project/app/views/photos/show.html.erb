<% if !@error %>
	<input type=hidden id="photoID" value='<%= @photo.id %>' >
	<h1><%= @photo.description %></h1>
	<h2>Uploaded by <a href="/users/<%=@user.id%>"><%= @user.username %></a></h2>
	
	<div class="pageText">
		Click <a href="/scrimages/<%=@photo.scrimage_id%>">here</a> to see the scrImage this photo is a part of
		<% if logged_in? %>
			| 
			<% unless current_user.favorite_photos.exists?(id: @photo.id) %>
			<%= link_to 'Favorite', favorite_photos_path(photo_id: @photo), method: :post %>
			<% else %>
			<%= link_to 'Unfavorite', favorite_photo_path(@photo), method: :delete %>
			<% end %>
		<% end %>
	</div>

	<table class="showPhoto">
		<tr>
			<td>
				<img class="mainPhoto" src="<%= @photo.filename %>"><br><br>
				<div id="commentsDiv" class="commentsDiv">
					<span>Comments</span>
					<br/>
					<% @comments.each do |comment| %>
						<% commenter = User.find(comment.user_id) %>
						<a href="/users/<%=commenter.id%>"><b><%= commenter.username %></b></a>: <%= comment.text %>
						<br/><br/>
					<% end %>
				</div>
				<% if logged_in? %>
					<br><br>
					<textarea id="new_comment_input" name="new_comment_input"></textarea>
					<div class="addComment">
						<button class="submit" style="margin-top:5px" onClick=addComment()>Add Comment</button>
				<% end %>
		</div>
	<% end %>
			</td>
			<td class='photoTreeTableCell'>
				<center><div id="photoTree"></div></center>
			</td>
		</tr>
		<tr>
			<td>
			</td>
		</tr>
	</table>
	

<script type="text/javascript">

	$(function(){
		$.ajax({
			url: "/photos/draw_tree",
			type: "POST",
			data: {photo_id: $("#photoID").val()},
			success: function(msg){
				// console.log(msg);
				$("#photoTree").html(msg);
			}
		});
	});

	function addComment(){
		$.ajax({
			url: "/photos/create_comment",
			type: "POST",
			data: {photo_id: $("#photoID").val(), text: $("#new_comment_input").val()},
			success: function(msg){
				// console.log(msg);
				$("#commentsDiv").append(msg);
				$("#new_comment_input").val("");
			}
		});
	}

</script>